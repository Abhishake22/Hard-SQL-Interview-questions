
Table structure - transactions

transaction_id	customer_id	transaction_date
1	101	2023-07-20
2	102	2023-07-15
3	101	2023-07-10
4	103	2023-07-12
5	102	2023-07-05
6	101	2023-06-28
7	103	2023-06-30
8	101	2023-06-25
                

SELECT
  customer_id,
  DATEDIFF(DAY, prev_max_transaction_date, max_transaction_date) AS days_difference
FROM (
  SELECT
    customer_id,
    transaction_date AS max_transaction_date,
    LAG(transaction_date) OVER (PARTITION BY customer_id ORDER BY transaction_date) AS prev_max_transaction_date,
    ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY transaction_date DESC) AS row_num
  FROM
    transactions
) AS customer_transactions
WHERE row_num = 1;


